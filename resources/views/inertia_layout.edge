<!DOCTYPE html>
<html lang="{{ locale || 'en' }}" data-theme="{{ page.component && page.component.startsWith('admin/') ? 'admin' : 'site' }}" class="{{ page.props.isDark ? 'dark' : '' }}">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title inertia>
      {{ page.props.siteTitle || 'EOS' }}
    </title>

    <link rel="preconnect" href="https://fonts.bunny.net" />
    <link rel="dns-prefetch" href="https://fonts.bunny.net" />
    <link
      href="https://fonts.bunny.net/css?family=outfit:100,200,300,400,500,600,700,800,900&display=swap"
      rel="stylesheet"
    />

    {{-- Theme Detection Script (runs before page render to prevent flicker) --}}
    <script>
      (function() {
        const adminPrefix = "{{ page.props.adminPathPrefix || 'admin' }}";
        const isAdmin = window.location.pathname.startsWith("/" + adminPrefix);
        const theme = isAdmin ? "admin" : "site";
        const defaultTheme = "{{ page.props.defaultThemeMode || 'light' }}";
        const stored = localStorage.getItem("theme-mode");
        let isDark = false;
        if (stored === "dark") { isDark = true; }
        else if (stored === "light") { isDark = false; }
        else if (window.matchMedia("(prefers-color-scheme: dark)").matches) { isDark = true; }
        else { isDark = defaultTheme === "dark"; }
        const root = document.documentElement;
        root.setAttribute("data-theme", theme);
        if (isDark) { root.classList.add("dark"); }
        else { root.classList.remove("dark"); }
      })();
    </script>

    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        min-height: 100dvh; width: 100%; overflow-x: hidden;
        font-family: 'Outfit', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans',
                'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
      }
      #app { min-height: 100dvh; }
      #app > div { animation: fadeIn 0.1s ease-in; will-change: opacity; }
      @keyframes fadeIn { from { opacity: 0.98; } to { opacity: 1; } }
      @media (prefers-reduced-motion: reduce) { #app > div { animation: none; } }
    </style>


    {{-- Tailwind compiled via Vite (class strategy) --}}

    {{-- Tailwind theme is configured via tailwind.config.js and compiled by Vite --}}

    @stack('dumper')
    @viteReactRefresh()
    @inertiaHead()
    {{-- Load the correct entrypoint based on the page namespace --}}
    @if(page.component && page.component.startsWith('admin/'))
      @vite(['inertia/admin/app.tsx'])
    @else
      @vite(['inertia/site/app.tsx'])
    @endif

    {{-- Lottie Player (for SVG animations / JSON) --}}
    @if(page.props.features && page.props.features.lottie)
      <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    @endif
  </head>

  <body>
    @inertia()
  </body>

</html>
